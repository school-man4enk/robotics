<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MicroPython —Ä–µ–¥–∞–∫—Ç–æ—Ä - –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥–æ–º ESP32</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.1/skulpt-stdlib.js"></script>
  <style>
    .code-editor {
      font-family: 'Courier New', monospace;
      tab-size: 4;
    }
    .line-numbers {
      background: #f8f9fa;
      color: #6c757d;
      border-right: 1px solid #dee2e6;
      user-select: none;
      font-family: 'Courier New', monospace;
    }
    .syntax-highlight {
      color: #0066cc;
    }
    .comment {
      color: #6a9955;
    }
    .string {
      color: #d14;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 font-sans min-h-screen">

  <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6 shadow-lg">
    <div class="max-w-6xl mx-auto">
      <h1 class="text-3xl font-bold text-center">üíª MicroPython —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è ESP32</h1>
      <p class="text-center text-sm mt-2 opacity-90">–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥–æ–º - —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è</p>
    </div>
  </header>

  <main class="max-w-6xl mx-auto mt-6 p-6">
    
    <!-- –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ -->
    <section class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-semibold text-blue-700 mb-4 flex items-center">
        <span class="mr-2">üìö</span> –¢–µ–æ—Ä—ñ—è
      </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-lg font-semibold mb-2">üß∞ –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:</h3>
          <ul class="list-disc pl-5 space-y-1">
            <li>ESP32 –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä</li>
            <li>–°–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥ (LED)</li>
            <li>–†–µ–∑–∏—Å—Ç–æ—Ä 220 –û–º</li>
            <li>–ú–∞–∫–µ—Ç–Ω–∞ –ø–ª–∞—Ç–∞ —Ç–∞ –¥—Ä–æ—Ç–∏</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-2">‚ö° –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:</h3>
          <ul class="list-disc pl-5 space-y-1">
            <li><code class="bg-gray-100 px-2 py-1 rounded">Pin(15, Pin.OUT)</code> - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–Ω–∞</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">led.on()</code> - —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">led.off()</code> - –≤–∏–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">sleep(n)</code> - –∑–∞—Ç—Ä–∏–º–∫–∞ n —Å–µ–∫—É–Ω–¥</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥—É -->
    <section class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-semibold text-blue-700 mb-4 flex items-center">
        <span class="mr-2">üë®‚Äçüíª</span> –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥—É
      </h2>
      
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- –ö–æ–¥ —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
        <div class="lg:w-1/2">
          <div class="border rounded-lg overflow-hidden shadow-inner">
            <div class="bg-gray-800 text-white px-4 py-2 text-sm font-medium flex justify-between items-center">
              <span>üìÑ main.py</span>
              <div class="space-x-2">
                <button onclick="runCode()" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs font-semibold transition-colors">
                  ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏
                </button>
                <button onclick="stopCode()" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-xs font-semibold transition-colors">
                  ‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏
                </button>
              </div>
            </div>
            <div class="flex">
              <div class="line-numbers p-4 text-right text-sm leading-6" id="lineNumbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></div>
              <textarea 
                id="codeEditor" 
                class="code-editor w-full p-4 border-0 focus:outline-none resize-none text-sm leading-6" 
                rows="20"
                placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à MicroPython –∫–æ–¥ —Ç—É—Ç..."
                oninput="updateLineNumbers()"
              >from machine import Pin
from time import sleep

led = Pin(15, Pin.OUT)

while True:
    led.on()   # –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥
    sleep(1)   # –ó–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞
    led.off()  # –í–∏–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥
    sleep(1)   # –ó–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞</textarea>
            </div>
          </div>
          
          <!-- –®–≤–∏–¥–∫—ñ —à–∞–±–ª–æ–Ω–∏ -->
          <div class="mt-4">
            <h3 class="font-semibold mb-2">‚ö° –®–≤–∏–¥–∫—ñ —à–∞–±–ª–æ–Ω–∏:</h3>
            <div class="flex flex-wrap gap-2">
              <button onclick="loadTemplate('basic')" class="bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded text-sm transition-colors">
                –ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥
              </button>
              <button onclick="loadTemplate('blink')" class="bg-green-100 hover:bg-green-200 px-3 py-1 rounded text-sm transition-colors">
                –ë–ª–∏–º–∞–Ω–Ω—è
              </button>
              <button onclick="loadTemplate('morse')" class="bg-purple-100 hover:bg-purple-200 px-3 py-1 rounded text-sm transition-colors">
                –ê–∑–±—É–∫–∞ –ú–æ—Ä–∑–µ (SOS)
              </button>
              <button onclick="loadTemplate('fade')" class="bg-orange-100 hover:bg-orange-200 px-3 py-1 rounded text-sm transition-colors">
                PWM –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—è
              </button>
            </div>
          </div>
        </div>
        
        <!-- –°–∏–º—É–ª—è—Ü—ñ—è ESP32 -->
        <div class="lg:w-1/2">
          <div class="bg-gray-900 rounded-lg p-6 text-white">
            <h3 class="font-semibold mb-4 flex items-center">
              <span class="mr-2">üî¨</span> –°–∏–º—É–ª—è—Ü—ñ—è ESP32
            </h3>
            
            <!-- ESP32 Board Visualization -->
            <div class="bg-gray-800 rounded-lg p-4 mb-4 relative">
              <div class="text-center mb-4">
                <div class="inline-block bg-blue-600 px-4 py-2 rounded text-sm font-mono">ESP32</div>
              </div>
              
              <!-- GPIO 15 Pin -->
              <div class="flex items-center justify-center mb-4">
                <div class="text-xs mr-2">GPIO 15</div>
                <div class="w-4 h-4 bg-yellow-500 rounded-full" id="gpio15"></div>
                <div class="mx-2">‚Äî</div>
                <!-- LED Visualization -->
                <div class="relative">
                  <div class="w-8 h-8 rounded-full border-2 border-gray-400 flex items-center justify-center" id="ledVisual">
                    <div class="w-4 h-4 rounded-full bg-gray-600 transition-all duration-300" id="ledLight"></div>
                  </div>
                  <div class="text-xs text-center mt-1">LED</div>
                </div>
                <div class="mx-2">‚Äî</div>
                <div class="text-xs">GND</div>
              </div>
              
              <!-- Status -->
              <div class="text-center">
                <div class="text-xs opacity-75">–°—Ç–∞–Ω:</div>
                <div id="ledStatus" class="font-semibold">–í–ò–ú–ö–ù–ï–ù–û</div>
              </div>
            </div>
            
            <!-- Console Output -->
            <div class="bg-black rounded p-3 h-32 overflow-y-auto font-mono text-sm" id="console">
              <div class="text-green-400">MicroPython –∫–æ–Ω—Å–æ–ª—å –≥–æ—Ç–æ–≤–∞...</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- –ó–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –≤–ø—Ä–∞–≤–∏ -->
    <section class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-semibold text-blue-700 mb-4 flex items-center">
        <span class="mr-2">üéØ</span> –ó–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –≤–ø—Ä–∞–≤–∏
      </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold text-blue-800 mb-2">üìù –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ë–∞–∑–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
            <p class="text-sm">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ–≥—Ä–∞–º—É, —è–∫–∞ –≤–º–∏–∫–∞—î —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏, –ø–æ—Ç—ñ–º –≤–∏–º–∏–∫–∞—î –π–æ–≥–æ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥–∏. –ü–æ–≤—Ç–æ—Ä—ñ—Ç—å —Ü–∏–∫–ª 5 —Ä–∞–∑—ñ–≤.</p>
          </div>
          
          <div class="bg-green-50 p-4 rounded-lg">
            <h3 class="font-semibold text-green-800 mb-2">üìù –ó–∞–≤–¥–∞–Ω–Ω—è 2: SOS —Å–∏–≥–Ω–∞–ª</h3>
            <p class="text-sm">–ó–∞–ø—Ä–æ–≥—Ä–∞–º—É–π—Ç–µ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —Å–∏–≥–Ω–∞–ª SOS –≤ –∞–∑–±—É—Ü—ñ –ú–æ—Ä–∑–µ: 3 –∫–æ—Ä–æ—Ç–∫—ñ, 3 –¥–æ–≤–≥—ñ, 3 –∫–æ—Ä–æ—Ç–∫—ñ –±–ª–∏–º–∞–Ω–Ω—è.</p>
          </div>
        </div>
        
        <div class="space-y-4">
          <div class="bg-purple-50 p-4 rounded-lg">
            <h3 class="font-semibold text-purple-800 mb-2">üìù –ó–∞–≤–¥–∞–Ω–Ω—è 3: –í–∏–ø–∞–¥–∫–æ–≤–µ –±–ª–∏–º–∞–Ω–Ω—è</h3>
            <p class="text-sm">–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –º–æ–¥—É–ª—å <code>urandom</code> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –±–ª–∏–º–∞–Ω–Ω—è –≤—ñ–¥ 0.1 –¥–æ 2 —Å–µ–∫—É–Ω–¥.</p>
          </div>
          
          <div class="bg-orange-50 p-4 rounded-lg">
            <h3 class="font-semibold text-orange-800 mb-2">üìù –ó–∞–≤–¥–∞–Ω–Ω—è 4: PWM –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—è</h3>
            <p class="text-sm">–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ PWM –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–º—ñ–Ω–∏ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥–∞ –≤—ñ–¥ 0% –¥–æ 100% —ñ –Ω–∞–∑–∞–¥.</p>
          </div>
        </div>
      </div>
    </section>

    <div class="mt-8 text-center">
      <a href="#" class="text-blue-600 hover:underline">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É —É—Ä–æ–∫—ñ–≤</a>
    </div>

  </main>

  <footer class="text-center mt-10 p-4 text-sm text-gray-500">
    &copy; 2025 –†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω—ñ–∫–∞. –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π MicroPython —Ä–µ–¥–∞–∫—Ç–æ—Ä
  </footer>

<script>
let isRunning = false;
let currentExecution = null;

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ —Ä—è–¥–∫—ñ–≤
function updateLineNumbers() {
  const textarea = document.getElementById('codeEditor');
  const lineNumbers = document.getElementById('lineNumbers');
  const lines = textarea.value.split('\n').length;
  
  let numbers = '';
  for (let i = 1; i <= Math.max(lines, 10); i++) {
    numbers += i + '<br>';
  }
  lineNumbers.innerHTML = numbers;
}

// –®–∞–±–ª–æ–Ω–∏ –∫–æ–¥—É
const templates = {
  basic: `from machine import Pin
from time import sleep

led = Pin(15, Pin.OUT)

led.on()   # –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥
sleep(3)   # –ó–∞—Ç—Ä–∏–º–∫–∞ 3 —Å–µ–∫—É–Ω–¥–∏
led.off()  # –í–∏–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥`,

  blink: `from machine import Pin
from time import sleep

led = Pin(15, Pin.OUT)

while True:
    led.on()   # –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥
    sleep(1)   # –ó–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞
    led.off()  # –í–∏–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ–¥—ñ–æ–¥
    sleep(1)   # –ó–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞`,

  morse: `from machine import Pin
from time import sleep

led = Pin(15, Pin.OUT)

def short_blink():
    led.on()
    sleep(0.2)
    led.off()
    sleep(0.2)

def long_blink():
    led.on()
    sleep(0.6)
    led.off()
    sleep(0.2)

# SOS —Å–∏–≥–Ω–∞–ª
for repeat in range(3):
    # S (3 –∫–æ—Ä–æ—Ç–∫—ñ)
    for i in range(3):
        short_blink()
    
    sleep(0.4)
    
    # O (3 –¥–æ–≤–≥—ñ)
    for i in range(3):
        long_blink()
    
    sleep(0.4)
    
    # S (3 –∫–æ—Ä–æ—Ç–∫—ñ)
    for i in range(3):
        short_blink()
    
    sleep(2)  # –ü–∞—É–∑–∞ –º—ñ–∂ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏`,

  fade: `from machine import Pin, PWM
from time import sleep

led = PWM(Pin(15), 1000)

for cycle in range(3):
    # –ü–ª–∞–≤–Ω–µ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è
    for duty in range(0, 1024, 50):
        led.duty(duty)
        sleep(0.05)
    
    # –ü–ª–∞–≤–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è
    for duty in range(1023, -1, -50):
        led.duty(duty)
        sleep(0.05)`
};

function loadTemplate(templateName) {
  document.getElementById('codeEditor').value = templates[templateName];
  updateLineNumbers();
  logToConsole(`–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —à–∞–±–ª–æ–Ω: ${templateName}`);
}

function logToConsole(message) {
  const console = document.getElementById('console');
  console.innerHTML += `<div class="text-green-400">${message}</div>`;
  console.scrollTop = console.scrollHeight;
}

function clearConsole() {
  document.getElementById('console').innerHTML = '<div class="text-green-400">MicroPython –∫–æ–Ω—Å–æ–ª—å –≥–æ—Ç–æ–≤–∞...</div>';
}

function updateLED(state, brightness = 100) {
  const ledLight = document.getElementById('ledLight');
  const ledStatus = document.getElementById('ledStatus');
  
  if (state) {
    ledLight.style.backgroundColor = `rgba(255, 255, 0, ${brightness/100})`;
    ledLight.style.boxShadow = `0 0 20px rgba(255, 255, 0, ${brightness/100})`;
    ledStatus.textContent = '–£–í–Ü–ú–ö–ù–ï–ù–û';
    ledStatus.style.color = '#10B981';
  } else {
    ledLight.style.backgroundColor = '#4B5563';
    ledLight.style.boxShadow = 'none';
    ledStatus.textContent = '–í–ò–ú–ö–ù–ï–ù–û';
    ledStatus.style.color = '#6B7280';
  }
}

function updateUI(running) {
  isRunning = running;
  const runBtn = document.querySelector('button[onclick="runCode()"]');
  const stopBtn = document.querySelector('button[onclick="stopCode()"]');
  
  runBtn.disabled = running;
  stopBtn.disabled = !running;
  
  if (running) {
    runBtn.classList.add('opacity-50', 'cursor-not-allowed');
    stopBtn.classList.remove('opacity-50', 'cursor-not-allowed');
  } else {
    runBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    stopBtn.classList.add('opacity-50', 'cursor-not-allowed');
  }
}

async function runCode() {
  if (isRunning) return;
  
  updateUI(true);
  clearConsole();
  
  const code = document.getElementById('codeEditor').value;
  currentExecution = { stopped: false };

  // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Skulpt
  Sk.configure({
    output: function(text) {
      logToConsole(text);
    },
    read: function(filename) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][filename] === undefined)
        throw "File not found: '" + filename + "'";
      return Sk.builtinFiles["files"][filename];
    },
    execLimit: 50000,
    syspath: [],
    __future__: Sk.python3,
    python3: true
  });

  // –°—Ç–≤–æ—Ä—é—î–º–æ Pin –∫–ª–∞—Å
  const PinClass = Sk.misceval.buildClass(new Sk.builtin.module(), function($gbl, $loc) {
    $loc.__init__ = new Sk.builtin.func(function(self, pin_num, mode) {
      self.pin_num = pin_num;
      self.mode = mode;
      self.state = false;
      self.pwm_mode = false;
      logToConsole(`Pin ${Sk.ffi.remapToJs(pin_num)} —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —è–∫ ${Sk.ffi.remapToJs(mode) === 1 ? 'OUTPUT' : 'INPUT'}`);
      return Sk.builtin.none.none$;
    });
    
    $loc.on = new Sk.builtin.func(function(self) {
      self.state = true;
      logToConsole(`Pin ${Sk.ffi.remapToJs(self.pin_num)} —É–≤—ñ–º–∫–Ω–µ–Ω–æ`);
      updateLED(true);
      return Sk.builtin.none.none$;
    });
    
    $loc.off = new Sk.builtin.func(function(self) {
      self.state = false;
      logToConsole(`Pin ${Sk.ffi.remapToJs(self.pin_num)} –≤–∏–º–∫–Ω–µ–Ω–æ`);
      updateLED(false);
      return Sk.builtin.none.none$;
    });
    
    $loc.value = new Sk.builtin.func(function(self, val) {
      if (val !== undefined) {
        self.state = Sk.ffi.remapToJs(val) ? true : false;
        updateLED(self.state);
        logToConsole(`Pin ${Sk.ffi.remapToJs(self.pin_num)} –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ ${self.state ? 'HIGH' : 'LOW'}`);
      }
      return new Sk.builtin.int_(self.state ? 1 : 0);
    });
  }, 'Pin', []);

  // –°—Ç–≤–æ—Ä—é—î–º–æ PWM –∫–ª–∞—Å
  const PWMClass = Sk.misceval.buildClass(new Sk.builtin.module(), function($gbl, $loc) {
    $loc.__init__ = new Sk.builtin.func(function(self, pin, freq) {
      self.pin = pin;
      self.freq = freq || new Sk.builtin.int_(1000);
      self.duty_val = 0;
      pin.pwm_mode = true;
      logToConsole(`PWM —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –Ω–∞ –ø—ñ–Ω—ñ ${Sk.ffi.remapToJs(pin.pin_num)} –∑ —á–∞—Å—Ç–æ—Ç–æ—é ${Sk.ffi.remapToJs(self.freq)} Hz`);
      return Sk.builtin.none.none$;
    });
    
    $loc.duty = new Sk.builtin.func(function(self, duty_value) {
      if (duty_value !== undefined) {
        self.duty_val = Sk.ffi.remapToJs(duty_value);
        const brightness = (self.duty_val / 1023) * 100;
        logToConsole(`PWM duty –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${self.duty_val} (${brightness.toFixed(1)}%)`);
        updateLED(self.duty_val > 0, brightness);
      }
      return new Sk.builtin.int_(self.duty_val);
    });
    
    $loc.freq = new Sk.builtin.func(function(self, freq_value) {
      if (freq_value !== undefined) {
        self.freq = freq_value;
        logToConsole(`PWM —á–∞—Å—Ç–æ—Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${Sk.ffi.remapToJs(freq_value)} Hz`);
      }
      return self.freq;
    });
  }, 'PWM', []);

  // –§—É–Ω–∫—Ü—ñ—è sleep –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –∑—É–ø–∏–Ω–∫–∏
  const sleepFunc = new Sk.builtin.func(function(seconds) {
    const s = Sk.ffi.remapToJs(seconds);
    const ms = Math.max(0, s * 1000);
    
    return Sk.misceval.promiseToSuspension(
      new Promise(resolve => {
        if (currentExecution && currentExecution.stopped) {
          resolve();
          return;
        }
        
        logToConsole(`–ü–∞—É–∑–∞ ${s} —Å–µ–∫...`);
        setTimeout(() => {
          resolve();
        }, ms);
      }).then(() => Sk.builtin.none.none$)
    );
  });

  // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑—É–ø–∏–Ω–∫–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏—Ö —Ü–∏–∫–ª—ñ–≤
  const stopRequestedFunc = new Sk.builtin.func(function() {
    return currentExecution && currentExecution.stopped ? 
      Sk.builtin.bool.true$ : Sk.builtin.bool.false$;
  });

  // –î–æ–¥–∞—î–º–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –¥–ª—è Pin —Ä–µ–∂–∏–º—ñ–≤
  PinClass.OUT = new Sk.builtin.int_(1);
  PinClass.IN = new Sk.builtin.int_(0);

  // –î–æ–¥–∞—î–º–æ –≤—Å–µ –¥–æ builtin –º–æ–¥—É–ª—ñ–≤
  Sk.builtins['Pin'] = PinClass;
  Sk.builtins['PWM'] = PWMClass;
  Sk.builtins['sleep'] = sleepFunc;
  Sk.builtins['_stop_requested'] = stopRequestedFunc;

  try {
    logToConsole('üöÄ –ü–æ—á–∞—Ç–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è MicroPython –ø—Ä–æ–≥—Ä–∞–º–∏...');
    
    // –ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–¥ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑—É–ø–∏–Ω–∫–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏—Ö —Ü–∏–∫–ª—ñ–≤
    let modifiedCode = code.replace(/while\s+True\s*:/g, 'while not _stop_requested():');
    
    await Sk.misceval.asyncToPromise(() => 
      Sk.importMainWithBody("__main__", false, modifiedCode, true)
    );
    
    if (!currentExecution.stopped) {
      logToConsole('‚úÖ –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!');
    } else {
      logToConsole('‚èπÔ∏è –ü—Ä–æ–≥—Ä–∞–º–∞ –∑—É–ø–∏–Ω–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º');
    }
  } catch (err) {
    if (currentExecution && currentExecution.stopped) {
      logToConsole('‚èπÔ∏è –ü—Ä–æ–≥—Ä–∞–º–∞ –∑—É–ø–∏–Ω–µ–Ω–∞');
    } else {
      logToConsole('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: ' + err.toString());
    }
  } finally {
    updateUI(false);
  }
}

function stopCode() {
  if (currentExecution) {
    currentExecution.stopped = true;
  }
  updateLED(false);
  updateUI(false);
  logToConsole('‚èπÔ∏è –ó—É–ø–∏–Ω–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏...');
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
document.addEventListener('DOMContentLoaded', function() {
  updateLineNumbers();
  updateUI(false);
});
</script>

</body>
</html>